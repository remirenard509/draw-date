<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>home</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="/app/src/Assets/favico.png" type="image/x-icon">
</head>
<body>
    <h2>Bienvenue sur draw date</h2>
    <div class ="container">
        <div id="draws-container"></div>
        <div id="description-container">
            <textarea id="draw_description_try" placeholder="Description du dessin"></textarea>
            <text id="hint" text=""></text>
            <div>
                <button onclick="displayHint()">Indice</button>
                <button id="compareButton" onclick="compareDescriptions()">Comparer</button>
                <button id="profil" onclick="window.location.href='/app/src/profil.html'">Mon profil</button>
                <button onclick="logout()">Déconnexion</button>
            </div>
        </div>
    </div>
    <script>
        //deconnexion supprime le local storage
        function logout() {
            localStorage.removeItem('id');
            localStorage.removeItem('token');
            window.location.href = '/app/src/login.html';
        }
        let randomDrawing = null;
        // Fonction pour récupérer et afficher les dessins SVG
        async function fetchUserDrawings() {
            try {
                const response = await fetch('/app/draws/', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json(); // Récupère les données JSON
                    const drawsContainer = document.getElementById('draws-container');

                    const randomIndex = Math.floor(Math.random() * data.length);
                    randomDrawing = data[randomIndex];
                    const svgElement = document.createElement('div');
                    svgElement.innerHTML = randomDrawing.draw_svg;
                    drawsContainer.appendChild(svgElement);
                  
                    return randomDrawing;

                } else {
                    const error = await response.json();
                    alert('Erreur : ' + error.error);
                }
            } catch (err) {
                console.error('Erreur lors de la requête :', err);
                alert('Une erreur est survenue.');
            }
        }

        function compareDescriptions() {
            if (!randomDrawing) {
                alert('Aucun dessin à comparer. Veuillez d\'abord charger un dessin.');
                return;
            }
            const drawDescriptionTry = document.getElementById('draw_description_try').value;
            const drawDescriptionFromServer = randomDrawing.draw_description;

            if (drawDescriptionTry.trim() === drawDescriptionFromServer.trim()) {
                alert('Les descriptions correspondent !');
            } else {
                alert('Les descriptions ne correspondent pas.');
            }
        }
        function displayHint() {
            const drawDescription = randomDrawing.draw_description;
            const hintText = hint(drawDescription);
            document.getElementById('hint').innerText = hintText;
        }   

        function hint(description) {
            return description
                .split(' ') // Divise la chaîne en mots
                .map(word => word.charAt(0) + word.slice(1).split('').map(letter => '.').join(''))
                .join(' '); // Recombine les mots en une seule chaîne
        }
        fetchUserDrawings(); 

    </script>
</body>
</html>